# Day5笔记

## ASP.NET Core

### 中间件

中间件是一种装配到应用管道以处理请求和响应的软件。 每个组件：

* 选择是否将请求传递到管道中的下一个组件。
* 可在管道中的下一个组件前后执行工作。
  请求委托用于生成请求管道。 请求委托处理每个 HTTP 请求。

#### 使用

使用终端委托Run或Use委托或创建中间件类并通过builder.UseMiddleware方法添加管道，请求管道中的每个中间件组件负责调用管道中的下一个组件，或使管道短路。 当中间件短路时，它被称为“终端中间件”，因为它阻止中间件进一步处理请求。到达终端中间件就会回传response，逆序经过中间件。

#### 常见场景顺序

异常/错误处理->HTTPS 重定向中间件->静态文件中间件->Cookie 策略中间件-> 用于路由请求的路由中间件
->身份验证中间件->用于授权用户访问安全资源的授权中间件->会话中间件->用于将 Razor Pages 终结点添加到请求管道的终结点路由中间件

#### 管道分支

Map扩展用作约定来创建管道分支。Map基于给定请求路径的匹配项来创建请求管道分支。MapWhen基于给定谓词的结果创建请求管道分支。UseWhen也基于给定谓词的结果创建请求管道分支。 与 MapWhen不同的是，如果这个分支不发生短路或包含终端中间件，则会重新加入主管道。

### 控制器

控制器用于对一组操作进行定义和分组。 操作（或操作方法）是控制器上一种用来处理请求的方法。 控制器按逻辑将类似的操作集合到一起。 通过这种操作的聚合，可以共同应用路由、缓存和授权等通用规则集。

- 传统路由：传统路由依赖于约定，即控制器名称和动作名称直接映射到 URL 路径。通常在应用程序启动时配置全局路由规则，可以在 `Startup` 类的 `Configure` 方法中进行配置。所有路由规则都集中在一个地方定义，便于管理和维护。
- 属性路由：可以在每个控制器和动作方法上直接定义路由模板，不再依赖于全局配置。控制器和动作方法的路由规则直接体现在它们的特性上，增强了代码的可读性。可以根据需要定义多个不同的路由模板，满足不同场景下的路由需求。

